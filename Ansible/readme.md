# Ansible Configuration for CI/CD Infrastructure

This directory contains Ansible playbooks and configuration files for setting up and managing the CI/CD tools required for the Ultimate CI/CD project.

## Overview

After provisioning the infrastructure with Terraform, Ansible automates the installation and configuration of:

- Jenkins CI server with necessary plugins and tools
- Nexus Repository Manager for artifact storage
- Docker and container runtime tools
- Essential development tools and dependencies

## Prerequisites

Before running these playbooks, ensure you have:

1. **Ansible Installation**:
   ```bash
   # Ubuntu/Debian
   sudo apt update
   sudo apt install ansible
   
   # RHEL/CentOS
   sudo yum install ansible
   
   # Verify installation
   ansible --version  # Should be 2.9+
   ```

2. **SSH Access** to the target servers:
   - Ensure the SSH key used in Terraform is available on your local machine
   - Verify SSH connectivity to the servers

3. **Inventory File**:
   - The inventory file should have been automatically generated by the Terraform script
   - If not, create it manually using the template below

## Inventory Setup

If the inventory wasn't automatically created by Terraform, create it:

```bash
# Create inventory file
cat > inventory <<EOF
[jenkins]
jenkins-server ansible_host=<JENKINS_IP> ansible_user=ec2-user

[nexus]
nexus-server ansible_host=<NEXUS_IP> ansible_user=ec2-user
EOF
```

Replace `<JENKINS_IP>` and `<NEXUS_IP>` with the public IP addresses of your servers.

## Available Playbooks

### 1. Installation Playbook (`installation.yml`)

This is the main playbook that sets up all CI/CD components:

- Common tools and dependencies
- Docker runtime environment
- Jenkins server with plugins
- Nexus Repository Manager
- Integration between components

### Running the Playbooks

To configure all the servers:

```bash
# Run the full installation playbook
ansible-playbook -i inventory installation.yml
```

The playbook execution will take approximately 10-15 minutes depending on server performance and network conditions.

### Verifying the Installation

After running the playbooks, verify that services are running correctly:

1. **Jenkins**: Access Jenkins at `http://<JENKINS_IP>:8080`
   - The initial admin password can be found on the Jenkins server: 
     ```bash
     ssh ec2-user@<JENKINS_IP> "sudo cat /var/lib/jenkins/secrets/initialAdminPassword"
     ```

2. **Nexus**: Access Nexus at `http://<NEXUS_IP>:8081`
   - Default credentials: admin/admin123
   - You'll be prompted to change the password on first login

## Customizing the Installation

To customize the installation, modify these files:

- `installation.yml`: The main playbook
- `tasks/install_docker.yml`: Docker installation tasks
- `tasks/install_jenkins.yml`: Jenkins installation tasks
- `tasks/install_nexus.yml`: Nexus installation tasks

## Troubleshooting

### Common Issues

1. **SSH Connection Failures**:
   ```bash
   # Check SSH connectivity
   ssh -i /path/to/key.pem ec2-user@<SERVER_IP>
   
   # Verify the inventory file has correct server IPs
   cat inventory
   ```

2. **Service Not Starting**:
   ```bash
   # Check service status on the remote server
   ssh ec2-user@<SERVER_IP> "sudo systemctl status jenkins"
   ssh ec2-user@<SERVER_IP> "sudo systemctl status nexus"
   
   # View service logs
   ssh ec2-user@<SERVER_IP> "sudo journalctl -u jenkins"
   ```

3. **Port Accessibility Issues**:
   ```bash
   # Check if the port is open on the server
   ssh ec2-user@<SERVER_IP> "sudo ss -tulpn | grep 8080"
   
   # Verify security group settings in AWS console
   ```

## Next Steps

Once the CI/CD infrastructure is configured:

1. Complete the initial setup of Jenkins and Nexus through their web interfaces
2. Proceed to the [Jenkins directory](../Jenkins/) to configure the Jenkins pipeline for your application